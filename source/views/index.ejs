<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOLUTION</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/billboard.js/3.1.5/billboard.min.js"></script>
    <link rel="stylesheet" href="/style/insight.min.css">
    <link rel="stylesheet1" href="/style/main.css" > 
</head>
<body>
   
    <link rel="stylesheet" href='/style/insight.min.css'>
    <link rel="stylesheet" href='/style/main.css'>
    
</head>
<body>

    <body>

        <div class="ECOLUTION">
            <img src="/resources/PSD/ProjectSplash_Cropped.png" alt="Company Logo">
          </div>


          <div class="nav-bar">
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/ecoTravelRoutes">Travel</a></li>
                <li><a href="/recycle">Recycle</a></li>
                <li><a href="/leaderboard">leaderboard</a></li>
                <li><a href="/setting">Settings</a></li>
                <% if (username) { %>
                    <li><a href="/logout" class="logout-link">
                        <button>Logout</button>
                    </a></li>
                <% } else { %>
                    <li><a href="/login" class="login-link">
                        <button>Login</button>
                    </a></li>
                    <li><a href="/register" class="register-link">
                        <button>Register</button>
                    </a></li>
                <% } %>
            </ul>
        </div>
    
        <% if (username) { %>
            <div class="user-greeting">
                Welcome, <%= username %>
            </div>
        <% } %>
        
        
    


    <!-- Bottom left Rectangle -->
    <div class="boxtl"></div>
    <!-- Top right box -->
    
      

   <div id="chart-wrapper">
    <div id="chart"></div>
</div>

<script>
    // Fetch the chart data from the server
    fetch('/chart-data')
        .then(response => response.json())
        .then(data => {
            // Generate the chart using billboard.js
            var chart = bb.generate({
                bindto: "#chart",
                transition: {
                    duration: 1000
                },
                bar: {
                    width: {
                        ratio: 0.5 // This controls the width of the bars in the chart.
                    }
                },
                data: {
                    type: "bar", // Specifies the chart type.
                    columns: [
                        ["data1", ...data.data1.map(() => 0)], // Initializes data1 with zeros.
                        ["data2", ...data.data2.map(() => 0)] // Initializes data2 with zeros.
                    ]
                }
            });

            // Update the chart data after a delay to create an animation effect.
            setTimeout(function() {
                chart.load({
                    columns: [
                        ["data1", ...data.data1], // Loads the actual data1 values.
                        ["data2", ...data.data2] // Loads the actual data2 values.
                    ]
                });
            }, 2000); // Delay before updating the chart data.
        });
</script>


<!-- Pie Chart Wrapper/CarbonBreakdown API passed/displayed into here -->
<div id="piechart-wrapper">
    <div id="piechart"></div>
</div>
<!-- Pie Chart Script -->
<script>
    // Fetch the power consumption data from the server
    fetch('/current-power-consumption')
        .then(response => response.json())
        .then(data => {
            // Assume data is an array of objects with 'fuel' and 'percentage' properties
            var columns = data.map(item => [item.fuel, item.percentage]);
            
            // Generate the pie chart using billboard.js
            var piechart = bb.generate({
                bindto: "#piechart",
                data: {
                    type: "pie", // Specifies the chart type as pie.
                    columns: columns
                },
                pie: {
                    label: {
                        show: false // Hides the label; set to true if you want to display them.
                    }
                },
                tooltip: {
                    format: {
                        value: function (value, ratio, id) {
                            return value + '%'; // Formatting the tooltip to show percentages
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error fetching power consumption data:', error);
        });
</script>



</body>
</html>
